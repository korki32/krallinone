<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recept Generátor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* Változók a sötét módhoz */
        .dark {
            --bg-primary: #111827;
            --bg-secondary: #1f2937;
        }

        .loading-animation {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: none;
            position: relative;
            background: radial-gradient(circle, var(--bg-primary, #f3f4f6) 8%, var(--bg-secondary, #ffffff) 9%, transparent 10%), conic-gradient(from 0deg, #e34e2c, #f7ba2c, #2a9d8f, #264653, #e34e2c);
            animation: spin 2s linear infinite;
        }

        .loading-animation::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg-secondary, white);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .message-box {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-950 text-gray-800 dark:text-gray-200 flex flex-col items-center justify-center min-h-screen p-4">
    <div class="container relative bg-white dark:bg-gray-900 p-8 rounded-2xl shadow-xl w-full">
        <!-- Témaváltó gomb a dobozon belül -->
        <div class="absolute top-4 right-4 z-50">
            <button id="themeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-800 text-gray-800 dark:text-gray-200 shadow-md transition-colors">
                <!-- Hold ikon (világos módhoz) -->
                <svg id="moonIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                </svg>
                <!-- Nap ikon (sötét módhoz) -->
                <svg id="sunIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
                </svg>
            </button>
        </div>
        
        <h1 class="text-4xl font-extrabold text-gray-800 dark:text-gray-200 text-center mb-6">Recept Generátor</h1>
        <p class="text-center text-gray-600 dark:text-gray-400 mb-8">Írd be azokat az alapanyagokat, amik a hűtődben vannak, és én generálok neked egy receptet!</p>
        
        <div class="space-y-4">
            <div>
                <label for="ingredientsInput" class="block text-lg font-semibold text-gray-700 dark:text-gray-300 mb-2">Alapanyagok (vesszővel elválasztva):</label>
                <textarea id="ingredientsInput" rows="4" class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200" placeholder="pl. csirke, rizs, paprika, hagyma"></textarea>
            </div>
            
            <button id="generateBtn" class="w-full bg-blue-600 dark:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors flex items-center justify-center space-x-2">
                <span id="buttonText">Recept generálása</span>
                <div id="loadingSpinner" class="loading-animation"></div>
            </button>
        </div>

        <div id="recipeOutput" class="mt-8 p-6 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-inner hidden">
            <h2 id="recipeTitle" class="text-3xl font-bold text-gray-800 dark:text-gray-200 mb-2"></h2>
            <p id="servings" class="text-gray-500 dark:text-gray-400 text-sm mb-4"></p>
            
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mt-6 mb-2">Hozzávalók:</h3>
            <ul id="ingredientsList" class="list-disc list-inside text-gray-600 dark:text-gray-400 leading-relaxed space-y-1"></ul>
            
            <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-300 mt-6 mb-2">Elkészítés:</h3>
            <div id="instructions" class="text-gray-600 dark:text-gray-400 leading-relaxed whitespace-pre-wrap"></div>
        </div>
        
        <!-- Lábléc a konténeren belül -->
        <footer class="mt-8 text-center text-gray-500 dark:text-gray-400 text-sm">
            © 2025 Korki32
        </footer>
    </div>
    
    <!-- Üzenetdoboz -->
    <div id="messageBox" class="message-box bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200">
        <p id="messageText" class="text-lg font-medium mb-4"></p>
        <button id="closeMessageBtn" class="bg-blue-600 dark:bg-blue-700 text-white px-4 py-2 rounded-lg hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors">OK</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ingredientsInput = document.getElementById('ingredientsInput');
            const generateBtn = document.getElementById('generateBtn');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const recipeOutput = document.getElementById('recipeOutput');
            const recipeTitle = document.getElementById('recipeTitle');
            const servingsEl = document.getElementById('servings');
            const ingredientsList = document.getElementById('ingredientsList');
            const instructions = document.getElementById('instructions');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBtn = document.getElementById('closeMessageBtn');
            const themeToggleBtn = document.getElementById('themeToggle');
            const moonIcon = document.getElementById('moonIcon');
            const sunIcon = document.getElementById('sunIcon');
            const body = document.body;

            // --- Éjszakai mód kezelése ---
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme === 'dark') {
                body.classList.add('dark');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                body.classList.remove('dark');
                moonIcon.classList.remove('hidden');
                sunIcon.classList.add('hidden');
            }

            themeToggleBtn.addEventListener('click', () => {
                body.classList.toggle('dark');
                // Az ikonok cseréje a body 'dark' osztályának állapota alapján
                if (body.classList.contains('dark')) {
                    localStorage.setItem('theme', 'dark');
                    moonIcon.classList.add('hidden');
                    sunIcon.classList.remove('hidden');
                } else {
                    localStorage.setItem('theme', 'light');
                    moonIcon.classList.remove('hidden');
                    sunIcon.classList.add('hidden');
                }
            });

            // --- Üzenetdoboz funkciók ---
            const showMessageBox = (message) => {
                messageText.textContent = message;
                messageBox.style.display = 'block';
            };

            const hideMessageBox = () => {
                messageBox.style.display = 'none';
            };

            closeMessageBtn.addEventListener('click', hideMessageBox);

            // --- Fetch függvény exponenciális visszalépéssel ---
            async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            if (response.status === 429 && i < retries - 1) { // 429 Túl sok kérés
                                console.warn(`Túl sok kérés, újrapróbálkozás ${delay}ms múlva...`);
                                await new Promise(resolve => setTimeout(resolve, delay));
                                delay *= 2; // Exponenciális visszalépés
                                continue;
                            }
                        }
                        return response;
                    } catch (error) {
                        if (i < retries - 1) {
                            console.warn(`Hiba a lekérdezésben: ${error.message}. Újrapróbálkozás ${delay}ms múlva...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2;
                            continue;
                        }
                        throw error;
                    }
                }
                throw new Error("Többszöri próbálkozás után sem sikerült a lekérdezés.");
            }

            // --- Recept generáló logika ---
            const generateRecipe = async () => {
                const ingredients = ingredientsInput.value.trim();
                if (ingredients === '') {
                    showMessageBox("Kérlek, adj meg legalább egy alapanyagot.");
                    return;
                }

                generateBtn.disabled = true;
                buttonText.textContent = 'Generálás...';
                loadingSpinner.style.display = 'block';
                recipeOutput.classList.add('hidden');

                const systemPrompt = "Te egy világhírű séf vagy. Generálj egyetlen, részletes receptet az alábbi alapanyagokból. A recept legyen életszerű és ne igényeljen speciális konyhai eszközöket. A recept tartalmazza a címet, a személyek számát, a hozzávalók pontos listáját mennyiségekkel és mértékegységekkel (pl. gramm, csésze), és az elkészítés lépésről lépésre történő, jól tagolt leírását. A hozzávalókat listaként sorold fel, minden elemet egy új sorba. Csak a receptet generáld.";
                const userQuery = `Recept generálása az alábbi alapanyagokból: ${ingredients}`;
                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                try {
                    const response = await fetchWithRetry(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API hiba: ${response.status} - ${errorData.error.message}`);
                    }

                    const result = await response.json();
                    const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;

                    if (generatedText) {
                        const lines = generatedText.split('\n');
                        let title = '';
                        let servings = '';
                        let ingredientsText = '';
                        let instructionsText = '';
                        let currentSection = '';

                        lines.forEach(line => {
                            if (line.includes('Recept címe:')) {
                                title = line.replace('Recept címe:', '').trim();
                                currentSection = 'title';
                            } else if (line.includes('Személyek száma:')) {
                                servings = line.replace('Személyek száma:', '').trim();
                                currentSection = 'servings';
                            } else if (line.includes('Hozzávalók:')) {
                                currentSection = 'ingredients';
                            } else if (line.includes('Elkészítés:')) {
                                currentSection = 'instructions';
                            } else {
                                if (currentSection === 'ingredients' && line.trim() !== '') {
                                    ingredientsText += line + '\n';
                                } else if (currentSection === 'instructions' && line.trim() !== '') {
                                    instructionsText += line + '\n';
                                }
                            }
                        });

                        recipeTitle.textContent = title || 'Ismeretlen Recept';
                        servingsEl.textContent = servings || 'Adatok hiányoznak';

                        ingredientsList.innerHTML = '';
                        const ingredientsArray = ingredientsText.split('\n').filter(line => line.trim() !== '');
                        ingredientsArray.forEach(item => {
                            const li = document.createElement('li');
                            li.textContent = item.replace(/^- /, '').replace(/^\* /, '').trim();
                            ingredientsList.appendChild(li);
                        });
                        instructions.textContent = instructionsText.trim() || 'Az elkészítés leírása hiányzik.';

                        recipeOutput.classList.remove('hidden');
                    } else {
                        showMessageBox("A generálás sikertelen. Kérlek, próbáld újra.");
                    }

                } catch (error) {
                    console.error('Hiba a recept generálásakor:', error);
                    showMessageBox(`Hiba a recept generálásakor: ${error.message}. Kérlek, próbáld újra.`);
                } finally {
                    generateBtn.disabled = false;
                    buttonText.textContent = 'Recept generálása';
                    loadingSpinner.style.display = 'none';
                }
            };

            generateBtn.addEventListener('click', generateRecipe);
        });
    </script>
</body>
</html>
