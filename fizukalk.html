<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Műszak és Fizetés Kalkulátor</title>
    <!-- Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #0d1117;
        }
        .glass-panel {
            background-color: rgba(24, 30, 41, 0.85);
            backdrop-filter: blur(12px);
            position: relative;
            z-index: 10;
            border: 1px solid #374151;
        }
        #futuristic-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }
        
        /* Custom styles to override Tailwind for the new theme */
        .container {
            width: 100%;
            max-width: 60rem;
            padding: 2rem;
            display: grid;
            gap: 2rem;
            grid-template-areas: "header" "main" "results";
        }
        @media (min-width: 1024px) {
            .container {
                grid-template-areas: "header header" "main main" "results results";
            }
        }
        .header { grid-area: header; }
        .main-content { grid-area: main; }
        .results-container { grid-area: results; }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .main-content {
                flex-direction: row;
            }
        }
        .calendar-container { flex: 1; }
        .controls-container { flex: 1; }
        
        .day {
            min-height: 3.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out, transform 0.2s ease-in-out;
            font-size: 0.875rem;
            color: #d1d5db;
        }
        .day:hover:not(.empty-day) { transform: scale(1.05); }
        .day.selected { background-color: #1e40af; font-weight: 600; color: white; }
        .day.vacation { background-color: #7f1d1d; font-weight: 600; color: white; }
        .day span.hours { font-size: 0.75rem; color: #9ca3af; margin-top: 0.25rem; }
        .day.selected .hours, .day.vacation .hours { color: #e5e7eb; }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: rgba(31, 41, 55, 0.95);
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 24rem;
            border: 1px solid #4b5563;
        }
        .message-box {
            display: none;
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 110;
            background-color: #1f2937;
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            border: 1px solid #4b5563;
        }
        .info-icon {
            cursor: help;
            color: #9ca3af;
            margin-left: 0.5rem;
            font-size: 1rem;
        }
        .disabled { opacity: 0.5; pointer-events: none; }
        .disabled-input { background-color: #4b5563; cursor: not-allowed; }
    </style>
</head>
<body class="flex flex-col items-center justify-start py-8 px-4">
    <canvas id="futuristic-canvas"></canvas>

    <div class="container glass-panel rounded-2xl">
        <!-- Header -->
        <div class="header">
            <h1 class="text-3xl font-bold text-white">Fizetéskalkulátor</h1>
        </div>
        
        <!-- Main content: Calendar and Controls -->
        <div class="main-content">
            <!-- Calendar Container -->
            <div class="calendar-container">
                <div class="flex items-center justify-between mb-4">
                    <button id="prevBtn" class="p-2 rounded-full bg-purple-600 text-white hover:bg-purple-700 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                    </button>
                    <h2 id="currentMonth" class="text-2xl font-bold text-white"></h2>
                    <button id="nextBtn" class="p-2 rounded-full bg-purple-600 text-white hover:bg-purple-700 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                    </button>
                </div>
                <div class="grid grid-cols-7 gap-1 text-center font-medium text-gray-400 text-sm">
                    <div class="p-2">H</div><div class="p-2">K</div><div class="p-2">Sze</div><div class="p-2">Cs</div><div class="p-2">P</div><div class="p-2">Szo</div><div class="p-2">V</div>
                </div>
                <div id="calendarDays" class="grid grid-cols-7 gap-1 text-center mt-2"></div>
            </div>

            <!-- Controls Container -->
            <div class="controls-container">
                <h2 class="text-2xl font-bold text-white mb-6">Beállítások</h2>
                <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                    <!-- Input fields -->
                    <div>
                        <label for="hourlyRate" class="block text-gray-400 font-medium mb-1 text-sm">Alap órabér (Ft)</label>
                        <input type="number" id="hourlyRate" value="1500" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Éjszakai pótlék (%)</label>
                        <input type="number" id="nightRate" value="25" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="nightStart" class="block text-gray-400 font-medium mb-1 text-sm">Éjszakai pótlék (kezdő óra)</label>
                        <input type="number" id="nightStart" value="22" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="nightEnd" class="block text-gray-400 font-medium mb-1 text-sm">Éjszakai pótlék (befejező óra)</label>
                        <input type="number" id="nightEnd" value="6" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Délutáni pótlék (%)</label>
                        <input type="number" id="eveningRate" value="15" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="eveningStart" class="block text-gray-400 font-medium mb-1 text-sm">Délutáni pótlék (kezdő óra)</label>
                        <input type="number" id="eveningStart" value="18" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="eveningEnd" class="block text-gray-400 font-medium mb-1 text-sm">Délutáni pótlék (befejező óra)</label>
                        <input type="number" id="eveningEnd" value="22" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Hétvégi pótlék (%)</label>
                        <input type="number" id="weekendRate" value="50" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label for="weekendOption" class="block text-gray-400 font-medium mb-1 text-sm">Hétvégi pótlék napjai</label>
                        <select id="weekendOption" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <option value="all">Szombat és Vasárnap</option>
                            <option value="saturday">Szombat</option>
                            <option value="sunday">Vasárnap</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Túlóra pótlék (%)</label>
                        <input type="number" id="overtimeRate" value="50" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Bónusz1 (Ft)</label>
                        <input type="number" id="bonus1" value="0" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-gray-400 font-medium mb-1 text-sm">Bónusz2 (Ft)</label>
                        <input type="number" id="bonus2" value="0" class="w-full p-3 bg-gray-800 text-white border border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <hr class="my-4 border-gray-600">
                    <h3 class="text-xl font-bold text-white mb-2">Adó- és Járulékkedvezmények</h3>
                    <div class="space-y-2 text-gray-300">
                        <!-- Checkboxes -->
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="ekho" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>EKHO adózás</span></label><button class="info-icon" data-info="ekho">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="under25" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>25 év alatti adómentesség</span></label><button class="info-icon" data-info="under25">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="under30mother" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>30 év alatti anyuka</span></label><button class="info-icon" data-info="under30mother">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="married" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>Friss házasok</span></label><button class="info-icon" data-info="married">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="personalDeduction" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>Személyi kedvezmény</span></label><button class="info-icon" data-info="personalDeduction">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="retiredEmployee" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>Nyugdíjas munkavállaló</span></label><button class="info-icon" data-info="retiredEmployee">i</button></div>
                        <div class="flex items-center"><label class="flex items-center"><input type="checkbox" id="mother4plus" class="rounded text-purple-500 focus:ring-purple-500 mr-2 bg-gray-700 border-gray-600"><span>4+ gyermeket nevelő anyák</span></label><button class="info-icon" data-info="mother4plus">i</button></div>
                    </div>
                    <button id="calculateBtn" class="w-full bg-green-600 text-white font-bold p-3 rounded-lg hover:bg-green-700 transition-colors duration-200 mt-4">
                        Számítás indítása
                    </button>
                </div>
            </div>
        </div>

        <!-- Results Container -->
        <div class="results-container">
            <h2 class="text-2xl font-bold text-white mb-6">Összesítés</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Összes munkaóra:</p><p id="totalHours" class="text-xl font-bold text-white mt-1">0 óra</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Alap bruttó:</p><p id="baseBrutto" class="text-xl font-bold text-white mt-1">0 Ft</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Éjszakai pótlék:</p><p id="nightBreakdown" class="text-xl font-bold text-white mt-1">0 óra (0 Ft)</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Délutáni pótlék:</p><p id="eveningBreakdown" class="text-xl font-bold text-white mt-1">0 óra (0 Ft)</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Hétvégi pótlék:</p><p id="weekendBreakdown" class="text-xl font-bold text-white mt-1">0 óra (0 Ft)</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Túlóra pótlék:</p><p id="overtimeBreakdown" class="text-xl font-bold text-white mt-1">0 óra (0 Ft)</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Szabadságidő:</p><p id="vacationHours" class="text-xl font-bold text-white mt-1">0 óra (0 Ft)</p></div>
                <div class="bg-gray-800 p-4 rounded-lg"><p class="text-gray-400 font-medium">Összes bónusz:</p><p id="totalBonus" class="text-xl font-bold text-white mt-1">0 Ft</p></div>
                <div class="bg-purple-600 text-white p-4 rounded-lg col-span-1 md:col-span-2 lg:col-span-3 text-center"><p class="font-medium">Várható Nettó Fizetés:</p><p id="nettoOutput" class="text-3xl font-bold mt-1">0 Ft</p></div>
            </div>
            
            <div id="savings-breakdown-container" class="mt-8 bg-gray-800 p-4 rounded-lg">
                <h3 class="text-xl font-bold text-white mb-4">Megtakarítási részletező</h3>
                <div id="savings-list" class="space-y-2">
                    <p class="text-gray-400" id="savings-placeholder">Jelölj be kedvezményeket a részletekhez.</p>
                </div>
                <div class="mt-4 border-t border-gray-700 pt-4">
                    <p class="font-medium text-gray-400">Teljes megtakarítás:</p>
                    <p id="totalSavings" class="text-2xl font-bold text-green-400 mt-1">0 Ft</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 pt-4 border-t border-gray-700 text-center text-xs text-gray-500">
            <p>&copy; 2024 Korki32</p>
        </div>
    </div>

    <!-- Modal for shift input -->
    <div id="shiftModal" class="modal">
        <div class="modal-content text-white">
            <h3 class="text-xl font-bold mb-4">Munkaidő megadása</h3>
            <div id="shift-inputs" class="space-y-4">
                <div class="mb-4">
                    <label for="startTime" class="block text-gray-400 font-medium mb-1">Kezdő óra</label>
                    <input type="time" id="startTime" class="w-full p-3 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div class="mb-4">
                    <label for="endTime" class="block text-gray-400 font-medium mb-1">Befejező óra</label>
                    <input type="time" id="endTime" class="w-full p-3 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
            </div>
            
            <div class="mb-4 flex flex-col space-y-2">
                <div class="flex items-center justify-between overtime-container">
                    <label for="overtimeCheckbox" class="flex items-center"><input type="checkbox" id="overtimeCheckbox" class="rounded text-purple-500 mr-2 bg-gray-700 border-gray-600"><span class="font-medium">Túlóra</span></label>
                    <input type="number" id="overtimeHoursInput" value="8" class="w-24 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-right">
                </div>
                <div class="flex items-center justify-between vacation-container">
                    <label for="vacationCheckbox" class="flex items-center"><input type="checkbox" id="vacationCheckbox" class="rounded text-purple-500 mr-2 bg-gray-700 border-gray-600"><span class="font-medium">Szabadság</span></label>
                    <input type="number" id="vacationHoursInput" value="8" class="w-24 p-2 bg-gray-700 border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-right">
                </div>
            </div>
            
            <div class="flex justify-between space-x-2">
                <button id="saveShiftBtn" class="w-full bg-green-600 text-white font-bold p-3 rounded-lg hover:bg-green-700 transition-colors duration-200">Mentés</button>
                <button id="cancelShiftBtn" class="w-full bg-red-600 text-white font-bold p-3 rounded-lg hover:bg-red-700 transition-colors duration-200">Törlés</button>
            </div>
        </div>
    </div>

    <!-- Message Box -->
    <div id="messageBox" class="message-box text-white">
        <p id="messageText" class="text-lg font-medium mb-4"></p>
        <button id="closeMessageBtn" class="bg-purple-600 px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors duration-200">OK</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('futuristic-canvas');
            const ctx = canvas.getContext('2d');
            let width, height;
            let particles = [];
            const particleCount = 200;

            function resizeCanvas() {
                width = canvas.width = window.innerWidth;
                height = canvas.height = window.innerHeight;
            }

            class Particle {
                constructor() {
                    this.x = Math.random() * width;
                    this.y = Math.random() * height;
                    this.vx = (Math.random() - 0.5) * 0.2;
                    this.vy = (Math.random() - 0.5) * 0.2;
                    this.radius = Math.random() * 1.5;
                    this.color = `rgba(44, 192, 235, ${Math.random() * 0.5 + 0.1})`;
                }
                update() {
                    this.x += this.vx;
                    this.y += this.vy;
                    if (this.x < 0 || this.x > width) this.vx *= -1;
                    if (this.y < 0 || this.y > height) this.vy *= -1;
                }
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    ctx.fillStyle = this.color;
                    ctx.fill();
                }
            }

            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }
            }

            function animate() {
                ctx.clearRect(0, 0, width, height);
                particles.forEach(p => { p.update(); p.draw(); });
                for (let i = 0; i < particles.length; i++) {
                    for (let j = i + 1; j < particles.length; j++) {
                        const dx = particles[i].x - particles[j].x;
                        const dy = particles[i].y - particles[j].y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        if (distance < 100) {
                            ctx.beginPath();
                            ctx.moveTo(particles[i].x, particles[i].y);
                            ctx.lineTo(particles[j].x, particles[j].y);
                            ctx.strokeStyle = `rgba(44, 192, 235, ${1 - distance / 100})`;
                            ctx.lineWidth = 0.2;
                            ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(animate);
            }

            resizeCanvas();
            initParticles();
            window.addEventListener('resize', resizeCanvas);
            animate();

            // Calculator logic starts here
            const calendarDaysEl = document.getElementById('calendarDays');
            const currentMonthEl = document.getElementById('currentMonth');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const hourlyRateInput = document.getElementById('hourlyRate');
            const nightRateInput = document.getElementById('nightRate');
            const nightStartInput = document.getElementById('nightStart');
            const nightEndInput = document.getElementById('nightEnd');
            const eveningRateInput = document.getElementById('eveningRate');
            const eveningStartInput = document.getElementById('eveningStart');
            const eveningEndInput = document.getElementById('eveningEnd');
            const weekendRateInput = document.getElementById('weekendRate');
            const weekendOptionSelect = document.getElementById('weekendOption');
            const overtimeRateInput = document.getElementById('overtimeRate');
            const bonus1Input = document.getElementById('bonus1');
            const bonus2Input = document.getElementById('bonus2');
            const ekhoCheckbox = document.getElementById('ekho');
            const under25Checkbox = document.getElementById('under25');
            const under30motherCheckbox = document.getElementById('under30mother');
            const marriedCheckbox = document.getElementById('married');
            const personalDeductionCheckbox = document.getElementById('personalDeduction');
            const retiredEmployeeCheckbox = document.getElementById('retiredEmployee');
            const mother4plusCheckbox = document.getElementById('mother4plus');
            const calculateBtn = document.getElementById('calculateBtn');
            const totalHoursEl = document.getElementById('totalHours');
            const baseBruttoEl = document.getElementById('baseBrutto');
            const nightBreakdownEl = document.getElementById('nightBreakdown');
            const eveningBreakdownEl = document.getElementById('eveningBreakdown');
            const weekendBreakdownEl = document.getElementById('weekendBreakdown');
            const overtimeBreakdownEl = document.getElementById('overtimeBreakdown');
            const vacationHoursEl = document.getElementById('vacationHours');
            const totalBonusEl = document.getElementById('totalBonus');
            const nettoOutputEl = document.getElementById('nettoOutput');
            const totalSavingsEl = document.getElementById('totalSavings');
            const savingsListEl = document.getElementById('savings-list');
            const savingsPlaceholderEl = document.getElementById('savings-placeholder');
            const shiftModal = document.getElementById('shiftModal');
            const shiftInputs = document.getElementById('shift-inputs');
            const startTimeInput = document.getElementById('startTime');
            const endTimeInput = document.getElementById('endTime');
            const overtimeCheckbox = document.getElementById('overtimeCheckbox');
            const overtimeHoursInput = document.getElementById('overtimeHoursInput');
            const vacationCheckbox = document.getElementById('vacationCheckbox');
            const vacationHoursInput = document.getElementById('vacationHoursInput');
            const saveShiftBtn = document.getElementById('saveShiftBtn');
            const cancelShiftBtn = document.getElementById('cancelShiftBtn');
            const messageBox = document.getElementById('messageBox');
            const messageText = document.getElementById('messageText');
            const closeMessageBtn = document.getElementById('closeMessageBtn');
            const infoButtons = document.querySelectorAll('.info-icon');
            
            let currentDate = new Date();
            let selectedDays = {};
            let activeDate = null;

            const formatCurrency = (amount) => {
                return `${Math.round(amount).toLocaleString('hu-HU')} Ft`;
            };

            const showMessageBox = (message) => {
                messageText.textContent = message;
                messageBox.style.display = 'block';
            };

            const hideMessageBox = () => {
                messageBox.style.display = 'none';
            };

            closeMessageBtn.addEventListener('click', hideMessageBox);

            infoButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const infoType = e.target.dataset.info;
                    let message = "";
                    switch(infoType) {
                        case 'ekho': message = "Az Egyszerűsített Közteherviselési Hozzájárulás (EKHO) egy adózási mód, amely helyettesíti a normál SZJA-t és a legtöbb járulékot. Külön szabályok vonatkoznak rá."; break;
                        case 'under25': message = "A 25 év alattiak mentesülnek a személyi jövedelemadó (SZJA) fizetése alól a bruttó átlagkereset mértékéig."; break;
                        case 'under30mother': message = "A 30 év alatti, gyermeket vállaló anyák adómentességet kapnak a fizetésükre a bruttó átlagkereset mértékéig."; break;
                        case 'married': message = "A friss házasok havonta adóalap-kedvezményt vehetnek igénybe a házasságkötést követő 24 hónapon keresztül."; break;
                        case 'personalDeduction': message = "A személyi kedvezményre jogosító betegségekkel élők (pl. cukorbetegség, laktóz- vagy gluténérzékenység) adóalap-kedvezményt vehetnek igénybe."; break;
                        case 'retiredEmployee': message = "A nyugdíjas munkavállalók mentesülnek a 18.5%-os TB-járulék fizetése alól, csak a 15%-os SZJA-t kell fizetniük."; break;
                        case 'mother4plus': message = "A 4 vagy több gyermeket nevelő anyák teljes mértékben mentesülnek a személyi jövedelemadó (SZJA) fizetése alól."; break;
                    }
                    showMessageBox(message);
                });
            });

            const renderCalendar = () => {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const lastDayOfMonth = new Date(year, month + 1, 0).getDate();
                const monthNames = ["Január", "Február", "Március", "Április", "Május", "Június", "Július", "Augusztus", "Szeptember", "Október", "November", "December"];
                
                currentMonthEl.textContent = `${monthNames[month]} ${year}`;
                calendarDaysEl.innerHTML = '';
                const startDay = (firstDayOfMonth === 0) ? 6 : firstDayOfMonth - 1;

                for (let i = 0; i < startDay; i++) {
                    calendarDaysEl.insertAdjacentHTML('beforeend', '<div class="p-2 day empty-day"></div>');
                }

                for (let i = 1; i <= lastDayOfMonth; i++) {
                    const dateString = `${year}-${String(month + 1).padStart(2, '0')}-${String(i).padStart(2, '0')}`;
                    const dayEl = document.createElement('div');
                    dayEl.className = 'p-2 rounded-lg day';
                    dayEl.dataset.date = dateString;
                    
                    const dayNumber = document.createElement('span');
                    dayNumber.textContent = i;
                    dayEl.appendChild(dayNumber);

                    if (selectedDays[dateString]) {
                        const dayData = selectedDays[dateString];
                        const hoursSpan = document.createElement('span');
                        hoursSpan.className = 'hours';
                        if (dayData.isVacation) {
                            dayEl.classList.add('vacation');
                            hoursSpan.textContent = `Szabi (${dayData.hours}ó)`;
                        } else if (dayData.isOvertime) {
                            dayEl.classList.add('selected'); // Or a different class for overtime
                            hoursSpan.textContent = `Túlóra (${dayData.hours}ó)`;
                        } else {
                            dayEl.classList.add('selected');
                            hoursSpan.textContent = `${dayData.hours}ó`;
                        }
                        dayEl.appendChild(hoursSpan);
                    }

                    dayEl.addEventListener('click', () => {
                        activeDate = dateString;
                        const dayData = selectedDays[activeDate] || {};
                        
                        vacationCheckbox.checked = dayData.isVacation || false;
                        overtimeCheckbox.checked = dayData.isOvertime || false;
                        startTimeInput.value = dayData.startTime || '08:00';
                        endTimeInput.value = dayData.endTime || '16:00';
                        overtimeHoursInput.value = dayData.overtimeHours || '8';
                        vacationHoursInput.value = dayData.vacationHours || '8';

                        const isSpecial = vacationCheckbox.checked || overtimeCheckbox.checked;
                        shiftInputs.classList.toggle('disabled', isSpecial);
                        [startTimeInput, endTimeInput].forEach(el => el.classList.toggle('disabled-input', isSpecial));
                        
                        shiftModal.style.display = 'flex';
                    });
                    calendarDaysEl.appendChild(dayEl);
                }
            };
            
            overtimeCheckbox.addEventListener('change', () => {
                if (overtimeCheckbox.checked) vacationCheckbox.checked = false;
                const isSpecial = vacationCheckbox.checked || overtimeCheckbox.checked;
                shiftInputs.classList.toggle('disabled', isSpecial);
                [startTimeInput, endTimeInput].forEach(el => el.classList.toggle('disabled-input', isSpecial));
            });

            vacationCheckbox.addEventListener('change', () => {
                if (vacationCheckbox.checked) overtimeCheckbox.checked = false;
                const isSpecial = vacationCheckbox.checked || overtimeCheckbox.checked;
                shiftInputs.classList.toggle('disabled', isSpecial);
                [startTimeInput, endTimeInput].forEach(el => el.classList.toggle('disabled-input', isSpecial));
            });
            
            const getShiftHoursInInterval = (startHour, endHour, intervalStart, intervalEnd) => {
                let hours = 0;
                let current = startHour;
                while (current !== endHour) {
                    if (intervalEnd > intervalStart) { // Normal interval (e.g., 18-22)
                        if (current >= intervalStart && current < intervalEnd) hours++;
                    } else { // Overnight interval (e.g., 22-06)
                        if (current >= intervalStart || current < intervalEnd) hours++;
                    }
                    current = (current + 1) % 24;
                }
                return hours;
            };

            const calculate = () => {
                let totalHours = 0, totalBasePay = 0, totalNightHours = 0, totalEveningHours = 0, totalWeekendHours = 0, totalOvertimeHours = 0, totalVacationHours = 0;
                const hourlyRate = parseFloat(hourlyRateInput.value) || 0;
                const nightRate = parseFloat(nightRateInput.value) / 100;
                const nightStart = parseFloat(nightStartInput.value);
                const nightEnd = parseFloat(nightEndInput.value);
                const eveningRate = parseFloat(eveningRateInput.value) / 100;
                const eveningStart = parseFloat(eveningStartInput.value);
                const eveningEnd = parseFloat(eveningEndInput.value);
                const weekendRate = parseFloat(weekendRateInput.value) / 100;
                const weekendOption = weekendOptionSelect.value;
                const overtimeRate = parseFloat(overtimeRateInput.value) / 100;
                const bonus1 = parseFloat(bonus1Input.value) || 0;
                const bonus2 = parseFloat(bonus2Input.value) || 0;
                
                [under25Checkbox, under30motherCheckbox, marriedCheckbox, personalDeductionCheckbox, retiredEmployeeCheckbox, mother4plusCheckbox]
                    .forEach(cb => cb.disabled = ekhoCheckbox.checked);

                for (const date in selectedDays) {
                    const dayData = selectedDays[date];
                    if (dayData.isVacation) { totalVacationHours += dayData.hours; continue; }
                    if (dayData.isOvertime) { totalOvertimeHours += dayData.hours; continue; }

                    const { startTime, endTime, hours } = dayData;
                    const startHour = parseInt(startTime.split(':')[0]);
                    const endHour = parseInt(endTime.split(':')[0]);
                    const totalDailyHours = parseFloat(hours);
                    totalHours += totalDailyHours;
                    totalBasePay += totalDailyHours * hourlyRate;
                    totalNightHours += getShiftHoursInInterval(startHour, endHour, nightStart, nightEnd);
                    totalEveningHours += getShiftHoursInInterval(startHour, endHour, eveningStart, eveningEnd);

                    const dayOfWeek = new Date(date).getDay();
                    const isWeekend = (weekendOption === 'all' && (dayOfWeek === 6 || dayOfWeek === 0)) || (weekendOption === 'saturday' && dayOfWeek === 6) || (weekendOption === 'sunday' && dayOfWeek === 0);
                    if (isWeekend) totalWeekendHours += totalDailyHours;
                }
                
                const totalVacationPay = totalVacationHours * hourlyRate;
                const totalNightPay = totalNightHours * hourlyRate * nightRate;
                const totalEveningPay = totalEveningHours * hourlyRate * eveningRate;
                const totalWeekendPay = totalWeekendHours * hourlyRate * weekendRate;
                const totalOvertimePay = totalOvertimeHours * hourlyRate * (1 + overtimeRate);
                const totalBonus = bonus1 + bonus2;
                const totalBrutto = totalBasePay + totalVacationPay + totalNightPay + totalEveningPay + totalWeekendPay + totalOvertimePay + totalBonus;
                
                let netto = 0, totalSavings = 0, savingsBreakdown = {};
                if (ekhoCheckbox.checked) {
                    netto = totalBrutto * (1 - 0.15 - 0.095); // EKHO 15% SZJA + 9.5% EKHO
                } else {
                    let szjaBase = totalBrutto;
                    const szjaRate = 0.15, tbRate = 0.185;
                    const under25MaxBrutto = 576601; 
                    
                    if (mother4plusCheckbox.checked) {
                        savingsBreakdown['4+ gyermekes anyák SZJA mentessége'] = szjaBase * szjaRate;
                        szjaBase = 0;
                    } else if (under25Checkbox.checked || under30motherCheckbox.checked) {
                        const deduction = Math.min(szjaBase, under25MaxBrutto);
                        savingsBreakdown[under25Checkbox.checked ? '25 év alatti adómentesség' : '30 év alatti anyuka'] = deduction * szjaRate;
                        szjaBase -= deduction;
                    }
                    if (personalDeductionCheckbox.checked) {
                        const deduction = 77300;
                        savingsBreakdown['Személyi kedvezmény'] = Math.min(szjaBase, deduction) * szjaRate;
                        szjaBase -= deduction;
                    }
                    if (marriedCheckbox.checked) {
                        const deduction = 33335;
                        savingsBreakdown['Friss házasok'] = Math.min(szjaBase, deduction) * szjaRate;
                        szjaBase -= deduction;
                    }
                    
                    const szja = Math.max(0, szjaBase) * szjaRate;
                    const tb = retiredEmployeeCheckbox.checked ? 0 : totalBrutto * tbRate;
                    if (retiredEmployeeCheckbox.checked) savingsBreakdown['Nyugdíjas (TB mentesség)'] = totalBrutto * tbRate;
                    
                    netto = totalBrutto - szja - tb;
                    totalSavings = Object.values(savingsBreakdown).reduce((sum, val) => sum + val, 0);
                }

                totalHoursEl.textContent = `${(totalHours + totalOvertimeHours + totalVacationHours).toFixed(1)} óra`;
                baseBruttoEl.textContent = formatCurrency(totalBasePay);
                nightBreakdownEl.textContent = `${totalNightHours.toFixed(1)} óra (${formatCurrency(totalNightPay)})`;
                eveningBreakdownEl.textContent = `${totalEveningHours.toFixed(1)} óra (${formatCurrency(totalEveningPay)})`;
                weekendBreakdownEl.textContent = `${totalWeekendHours.toFixed(1)} óra (${formatCurrency(totalWeekendPay)})`;
                overtimeBreakdownEl.textContent = `${totalOvertimeHours.toFixed(1)} óra (${formatCurrency(totalOvertimePay)})`;
                vacationHoursEl.textContent = `${totalVacationHours} óra (${formatCurrency(totalVacationPay)})`;
                totalBonusEl.textContent = formatCurrency(totalBonus);
                nettoOutputEl.textContent = formatCurrency(netto);
                totalSavingsEl.textContent = formatCurrency(totalSavings);
                
                savingsListEl.innerHTML = '';
                if(Object.keys(savingsBreakdown).length > 0) {
                    savingsPlaceholderEl.style.display = 'none';
                    for(const [key, value] of Object.entries(savingsBreakdown)) {
                        savingsListEl.insertAdjacentHTML('beforeend', `<p class="text-gray-300"><span class="font-bold">${key}</span>: ${formatCurrency(value)}</p>`);
                    }
                } else {
                    savingsPlaceholderEl.style.display = 'block';
                }
            };

            prevBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(); });
            nextBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(); });

            saveShiftBtn.addEventListener('click', () => {
                if (!activeDate) return;
                
                if (vacationCheckbox.checked) {
                    selectedDays[activeDate] = { isVacation: true, hours: parseInt(vacationHoursInput.value) || 0 };
                } else if (overtimeCheckbox.checked) {
                    selectedDays[activeDate] = { isOvertime: true, hours: parseInt(overtimeHoursInput.value) || 0 };
                } else {
                    const start = startTimeInput.value, end = endTimeInput.value;
                    const startHour = parseInt(start.split(':')[0]), startMinute = parseInt(start.split(':')[1]);
                    const endHour = parseInt(end.split(':')[0]), endMinute = parseInt(end.split(':')[1]);
                    let hours = (endHour - startHour) + (endMinute - startMinute) / 60;
                    if (hours < 0) hours += 24;
                    
                    if (hours > 0) selectedDays[activeDate] = { startTime: start, endTime: end, hours: hours.toFixed(1) };
                    else delete selectedDays[activeDate];
                }
                shiftModal.style.display = 'none';
                renderCalendar();
                calculate();
            });

            cancelShiftBtn.addEventListener('click', () => {
                if (activeDate) delete selectedDays[activeDate];
                shiftModal.style.display = 'none';
                renderCalendar();
                calculate();
            });

            document.querySelectorAll('input, select').forEach(el => {
                el.addEventListener('change', calculate);
                if (el.type === 'number') el.addEventListener('input', calculate);
            });
            calculateBtn.addEventListener('click', calculate);

            renderCalendar();
            calculate();
        });
    </script>
</body>
</html>

