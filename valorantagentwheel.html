<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Valorant Agent Wheel — Responsive + Winner Anim + Stats</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        #wheel {
            transition: transform 0.2s ease-out;
            display: block;
            box-shadow: 0 0 20px rgba(255, 70, 85, 0.5);
        }
        #indicator {
            position: absolute;
            top: -26px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5rem;
            color: #FF4655;
            text-shadow: 0 0 10px rgba(255, 70, 85, 0.8);
            z-index: 10;
            pointer-events: none;
        }
        .agent-image.inactive {
            border-color: #FF4655 !important;
            filter: grayscale(80%) brightness(50%);
            opacity: 0.5;
        }
        .winner-highlight {
            animation: winner-glow 1.8s ease-in-out;
            border-radius: 0.5rem;
            transform: translateZ(0) scale(1.03);
            box-shadow: 0 0 30px rgba(255,70,85,0.9), 0 0 6px rgba(255,255,255,0.9) inset;
            z-index: 50;
        }
        @keyframes winner-glow {
            0% { box-shadow: 0 0 6px rgba(255,70,85,0.6); }
            50% { box-shadow: 0 0 30px rgba(255,70,85,0.95); }
            100% { box-shadow: 0 0 6px rgba(255,70,85,0.6); }
        }
        @media (max-width: 640px) {
            #indicator { font-size: 2rem; top: -22px; }
        }
        .role-stats { font-size: 0.9rem; color: #cbd5e1; margin-left: 0.6rem; }
    </style>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'valo-red': '#FF4655',
                        'valo-dark': '#0F1923',
                        'valo-gray': '#2A343D',
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body class="bg-valo-dark text-white min-h-screen flex flex-col font-sans" 
      style="background-image: url('images/valorant/valorant_background.jpg'); background-size: cover; background-attachment: fixed;">
    
    <audio id="spin-sound" src="sounds/valorant/spin.mp3" preload="auto"></audio>
    <audio id="stop-sound" src="sounds/valorant/stop.mp3" preload="auto"></audio>

    <header class="bg-black bg-opacity-70 p-5 text-center shadow-lg">
        <h1 class="text-3xl font-bold text-valo-red uppercase tracking-wider">Valorant Agent Wheel</h1>
    </header>

    <main class="flex-grow flex flex-col lg:flex-row items-start justify-center p-4 lg:p-8">
        <section class="w-full lg:w-2/5 p-4 bg-valo-dark bg-opacity-90 rounded-xl shadow-2xl mb-6 lg:mb-0 lg:mr-8 flex flex-col items-center">
            <div id="wheel-container" class="wheel-container relative flex flex-col items-center justify-center w-full max-w-lg">
                <div class="wheel-wrapper relative w-full">
                    <canvas id="wheel" class="rounded-full bg-black border-4 border-valo-red"></canvas>
                    <div id="indicator">▼</div>
                </div>
                <button id="spin" 
                        class="mt-8 px-10 py-4 bg-valo-red hover:bg-red-700 text-white font-extrabold text-xl uppercase rounded-lg shadow-xl transition duration-300 transform hover:scale-105 disabled:opacity-50">
                    PÖRGETÉS
                </button>
                <p class="mt-4 text-xs text-gray-400 max-w-xs">
                    TIPP: Kattints az ügynök képekre lent, hogy ki- vagy bekapcsold őket a keréken!
                </p>
                <p id="result-text" class="mt-4 text-2xl font-bold text-green-400" aria-live="assertive"></p>
            </div>
        </section>

        <section class="w-full lg:w-3/5">
            <div id="agent-list-container" class="space-y-6"></div>
        </section>
    </main>

    <footer class="bg-black bg-opacity-70 text-center p-3 text-sm text-gray-400">
        <p>&copy; 2024 Korki32</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const AGENT_STORAGE_KEY = 'valorantAgentWheelState';
            const agentData = {
                'Initiator': [
                    { name: 'Sova', image: 'images/valorant/agent_sova.png' },
                    { name: 'Breach', image: 'images/valorant/agent_breach.png' },
                    { name: 'Skye', image: 'images/valorant/agent_skye.png' },
                    { name: 'KAY/O', image: 'images/valorant/agent_kayo.png' },
                    { name: 'Fade', image: 'images/valorant/agent_fade.png' },
                    { name: 'Gekko', image: 'images/valorant/agent_gekko.png' }
                ],
                'Sentinel': [
                    { name: 'Cypher', image: 'images/valorant/agent_cypher.png' },
                    { name: 'Sage', image: 'images/valorant/agent_sage.png' },
                    { name: 'Killjoy', image: 'images/valorant/agent_killjoy.png' },
                    { name: 'Chamber', image: 'images/valorant/agent_chamber.png' },
                    { name: 'Deadlock', image: 'images/valorant/agent_deadlock.png' }
                ],
                'Duelist': [
                    { name: 'Jett', image: 'images/valorant/agent_jett.png' },
                    { name: 'Phoenix', image: 'images/valorant/agent_phoenix.png' },
                    { name: 'Reyna', image: 'images/valorant/agent_reyna.png' },
                    { name: 'Raze', image: 'images/valorant/agent_raze.png' },
                    { name: 'Yoru', image: 'images/valorant/agent_yoru.png' },
                    { name: 'Neon', image: 'images/valorant/agent_neon.png' }
                ],
                'Controller': [
                    { name: 'Brimstone', image: 'images/valorant/agent_brimstone.png' },
                    { name: 'Viper', image: 'images/valorant/agent_viper.png' },
                    { name: 'Omen', image: 'images/valorant/agent_omen.png' },
                    { name: 'Astra', image: 'images/valorant/agent_astra.png' },
                    { name: 'Harbor', image: 'images/valorant/agent_harbor.png' }
                ]
            };

            let agents = [];
            for (const role in agentData) {
                agents = agents.concat(agentData[role].map(a => ({ ...a, role, excluded: false })));
            }

            function saveAgentState() {
                const stateToSave = agents.map(a => ({ name: a.name, excluded: a.excluded }));
                localStorage.setItem(AGENT_STORAGE_KEY, JSON.stringify(stateToSave));
            }

            function loadAgentState() {
                const storedState = localStorage.getItem(AGENT_STORAGE_KEY);
                if (storedState) {
                    const parsedState = JSON.parse(storedState);
                    parsedState.forEach(storedAgent => {
                        const existingAgent = agents.find(a => a.name === storedAgent.name);
                        if (existingAgent) existingAgent.excluded = !!storedAgent.excluded;
                    });
                }
            }

            const canvas = document.getElementById('wheel');
            const ctx = canvas.getContext('2d');
            const spinButton = document.getElementById('spin');
            const spinSound = document.getElementById('spin-sound');
            const stopSound = document.getElementById('stop-sound');
            const resultText = document.getElementById('result-text');

            let currentAngle = 0;
            let spinning = false;

            function resizeCanvas() {
                const size = Math.min(window.innerWidth * 0.8, 500);
                canvas.width = size;
                canvas.height = size;
                drawWheel();
            }

            window.addEventListener('resize', resizeCanvas);

            function drawWheel() {
                const activeAgents = agents.filter(agent => !agent.excluded);
                if (activeAgents.length === 0) {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    resultText.textContent = 'Nincs aktív ügynök!';
                    spinButton.disabled = true;
                    return;
                }
                spinButton.disabled = false;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const radius = canvas.width / 2;
                ctx.save();
                ctx.translate(radius, radius);
                ctx.rotate(currentAngle);

                const angleStep = (2 * Math.PI) / activeAgents.length;
                const colors = ['#FF4655', '#1F2937'];

                activeAgents.forEach((agent, i) => {
                    const startAngle = i * angleStep;
                    ctx.beginPath();
                    ctx.moveTo(0, 0);
                    ctx.arc(0, 0, radius, startAngle, startAngle + angleStep);
                    ctx.closePath();
                    ctx.fillStyle = colors[i % colors.length];
                    ctx.fill();
                    ctx.strokeStyle = '#0F1923';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    ctx.save();
                    ctx.rotate(startAngle + angleStep / 2);
                    ctx.textAlign = 'right';
                    ctx.fillStyle = '#fff';
                    ctx.font = 'bold 14px Inter';
                    ctx.fillText(agent.name, radius - 10, 0);
                    ctx.restore();
                });

                ctx.restore();
            }

            function spinWheel(spinAngle, spinDuration, winnerIndex) {
                const startTime = Date.now();
                const initialAngle = currentAngle;
                const finalAngle = initialAngle + spinAngle - (winnerIndex * ((2 * Math.PI) / agents.filter(a => !a.excluded).length));

                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / spinDuration, 1);
                    currentAngle = initialAngle + (finalAngle - initialAngle) * (1 - Math.pow(1 - progress, 3));
                    drawWheel();

                    if (progress < 1) requestAnimationFrame(animate);
                    else {
                        spinning = false;
                        stopSound.play();
                        determineWinner(winnerIndex);
                    }
                }
                animate();
            }

            function determineWinner(index) {
                const activeAgents = agents.filter(agent => !agent.excluded);
                if (activeAgents.length === 0) return;
                const winner = activeAgents[index];
                resultText.textContent = `Nyertes: ${winner.name} (${winner.role})`;
                const winnerCard = document.querySelector(`[data-agent-name="${winner.name}"]`);
                if (winnerCard) {
                    winnerCard.classList.add('winner-highlight');
                    setTimeout(() => winnerCard.classList.remove('winner-highlight'), 2400);
                }
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            }

            spinButton.addEventListener('click', () => {
                const activeAgents = agents.filter(agent => !agent.excluded);
                if (spinning || activeAgents.length === 0) return;
                spinning = true;
                spinSound.play();

                const winnerIndex = Math.floor(Math.random() * activeAgents.length);
                const spinAngle = (6 + Math.random() * 3) * 2 * Math.PI;
                const spinDuration = 5000 + Math.random() * 2000;

                spinWheel(spinAngle, spinDuration, winnerIndex);
            });

            loadAgentState();
            resizeCanvas();
        });
    </script>
</body>
</html>
